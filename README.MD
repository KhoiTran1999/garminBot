# üèÉ‚Äç‚ôÇÔ∏è Garmin AI Coach Pro (Notion Integrated)

**Tr·ª£ l√Ω ·∫£o Hu·∫•n luy·ªán vi√™n ch·∫°y b·ªô c√° nh√¢n h√≥a, s·ª≠ d·ª•ng d·ªØ li·ªáu Garmin, Google Gemini AI v√† qu·∫£n l√Ω qua Notion.**

D·ª± √°n n√†y t·ª± ƒë·ªông h√≥a quy tr√¨nh thu th·∫≠p d·ªØ li·ªáu s·ª©c kh·ªèe t·ª´ Garmin Connect, t√≠nh to√°n c√°c ch·ªâ s·ªë chuy√™n s√¢u (Training Readiness, TRIMP), k·∫øt h·ª£p v·ªõi **ng·ªØ c·∫£nh c√° nh√¢n t·ª´ Notion** (M·ª•c ti√™u, Ch·∫•n th∆∞∆°ng) ƒë·ªÉ ƒë∆∞a ra l·ªùi khuy√™n t·∫≠p luy·ªán h√†ng ng√†y qua Telegram.

## ‚ú® T√≠nh nƒÉng n·ªïi b·∫≠t

* **‚ö° On-Demand Trigger (M·ªõi):**
    * Chat l·ªánh tr·ª±c ti·∫øp tr√™n Telegram ƒë·ªÉ k√≠ch ho·∫°t ph√¢n t√≠ch ngay l·∫≠p t·ª©c (`/daily`, `/sleep`, `/workout`).
    * S·ª≠ d·ª•ng **Cloudflare Workers** (Serverless) l√†m c·∫ßu n·ªëi, kh√¥ng c·∫ßn treo m√°y t√≠nh 24/7.

* **üß† Notion Database Integration:**
    * Qu·∫£n l√Ω danh s√°ch ng∆∞·ªùi d√πng, m·∫≠t kh·∫©u v√† tr·∫°ng th√°i Active tr·ª±c quan tr√™n Notion.
    * **C√° nh√¢n h√≥a theo th·ªùi gian th·ª±c:** C·∫≠p nh·∫≠t "M·ª•c ti√™u" ho·∫∑c "T√¨nh tr·∫°ng ch·∫•n th∆∞∆°ng" tr√™n Notion, AI s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh gi√°o √°n ngay l·∫≠p t·ª©c.

* **üìä Ph√¢n t√≠ch D·ªØ li·ªáu Chuy√™n s√¢u:**
    * **Gi·∫•c ng·ªß:** Ph√¢n t√≠ch chi ti·∫øt 3 giai ƒëo·∫°n (Deep, Light, REM) v√† th·ªùi gian ng·ªß th·ª±c t·∫ø (tr·ª´ l√∫c t·ªânh gi·∫•c).
    * **Training Readiness:** T√≠nh ƒëi·ªÉm s·∫µn s√†ng d·ª±a tr√™n Pin c∆° th·ªÉ (Body Battery), Stress v√† Gi·∫•c ng·ªß.
    * **Acute Training Load (7 ng√†y):** T√≠nh to√°n t·∫£i t·∫≠p luy·ªán d·ª±a tr√™n nh·ªãp tim (TRIMP Banister).

* **ü§ñ AI Coach (Gemini 2.0 Flash):** * ƒê√≥ng vai HLV chuy√™n nghi·ªáp, ƒë∆∞a ra b√†i t·∫≠p c·ª• th·ªÉ (Pace, Th·ªùi gian) d·ª±a tr√™n th·ªÉ tr·∫°ng th·ª±c t·∫ø.
    * T·ª± ƒë·ªông t·∫°o **Voice Script** (Text-to-Speech) ƒë·ªÉ g·ª≠i l·ªùi nh·∫Øn ƒë·ªông vi√™n b·∫±ng gi·ªçng n√≥i.

* **üì≤ Telegram Bot:**
    * **Morning Report (7:30 AM):** Ph√¢n t√≠ch gi·∫•c ng·ªß v√† l·ªùi khuy√™n ƒë·∫ßu ng√†y.
    * **Training Report (5:00 PM):** G·ª≠i gi√°o √°n chi ti·∫øt v√† ph√¢n t√≠ch t·∫£i l∆∞·ª£ng v·∫≠n ƒë·ªông.

* **‚òÅÔ∏è T·ª± ƒë·ªông h√≥a 100%:** Ch·∫°y mi·ªÖn ph√≠ tr√™n GitHub Actions.

## üõ†Ô∏è Y√™u c·∫ßu chu·∫©n b·ªã

ƒê·ªÉ ch·∫°y d·ª± √°n, b·∫°n c·∫ßn:

1.  **T√†i kho·∫£n Garmin Connect:** Email v√† M·∫≠t kh·∫©u.
2.  **Google Gemini API Key:** L·∫•y mi·ªÖn ph√≠ t·∫°i [Google AI Studio](https://aistudio.google.com/).
3.  **Telegram Bot:** Token v√† Chat ID (l·∫•y t·ª´ @BotFather v√† @userinfobot).
4.  **Notion Integration:**
    * T·∫°o Database tr√™n Notion.
    * L·∫•y `NOTION_TOKEN` v√† `NOTION_DATABASE_ID`.
5.  **Cloudflare Account (Free):** ƒê·ªÉ t·∫°o Worker l√†m Webhook trigger (n·∫øu d√πng t√≠nh nƒÉng chat l·ªánh).

## üóÇÔ∏è C·∫•u tr√∫c Database tr√™n Notion

B·∫°n c·∫ßn t·∫°o m·ªôt Database (Full page) tr√™n Notion v·ªõi c√°c c·ªôt ch√≠nh x√°c nh∆∞ sau ƒë·ªÉ Code ho·∫°t ƒë·ªông:

| T√™n C·ªôt (Property)          | Lo·∫°i (Type) | M√¥ t·∫£                                                 |
| --------------------------- | ----------- | ----------------------------------------------------- |
| **Name** | Title       | T√™n hi·ªÉn th·ªã c·ªßa VƒêV.                                 |
| **Email** | Email       | Email ƒëƒÉng nh·∫≠p Garmin.                               |
| **Password** | Text        | M·∫≠t kh·∫©u Garmin.                                      |
| **Telegram Chat ID** | Text        | ID chat Telegram (D·∫°ng Text ƒë·ªÉ tr√°nh l·ªói format s·ªë).  |
| **Training Goal** | Text        | VD: "Marathon Sub 4", "Ch·∫°y d∆∞·ª°ng sinh".              |
| **Ch·∫•n th∆∞∆°ng & B·ªánh t·∫≠t** | Text        | VD: "ƒêau g·ªëi ph·∫£i", "ƒêang ·ªëm".                        |
| **Ghi ch√∫** | Text        | Ghi ch√∫ th√™m cho AI.                                  |
| **Active** | Checkbox    | Tick ‚úÖ ƒë·ªÉ b·∫≠t Bot cho user n√†y.                        |

> **L∆∞u √Ω:** Sau khi t·∫°o Database, h√£y nh·ªõ c·∫•p quy·ªÅn cho Bot truy c·∫≠p b·∫±ng c√°ch b·∫•m v√†o `...` > `Connections` > `Connect to` > Ch·ªçn Integration c·ªßa b·∫°n.

## üöÄ C√†i ƒë·∫∑t & Ch·∫°y (Local)

1.  **Clone repository:**
    ```bash
    git clone [https://github.com/khoitran1999/garminbot.git](https://github.com/khoitran1999/garminbot.git)
    cd garminbot
    ```

2.  **C√†i ƒë·∫∑t th∆∞ vi·ªán:**
    ```bash
    pip install -r requirements.txt
    ```
    *(ƒê·∫£m b·∫£o ƒë√£ c√≥ `notion-client` v√† `garminconnect` b·∫£n m·ªõi nh·∫•t)*.

3.  **C·∫•u h√¨nh bi·∫øn m√¥i tr∆∞·ªùng:**
    T·∫°o file `.env` v·ªõi n·ªôi dung:
    ```env
    TELEGRAM_TOKEN="your_tele_token"
    GEMINI_API_KEY="your_gemini_key"
    NOTION_TOKEN="secret_your_notion_token"
    NOTION_DATABASE_ID="your_database_id"
    ```

4.  **Ch·∫°y th·ª≠ nghi·ªám:**
    * Ch·∫°y Bot ch√≠nh (Ch·∫ø ƒë·ªô Daily): 
        ```bash
        python main.py --mode daily
        ```
    * Ch·∫°y Bot Sleep Analysis (Ch·∫ø ƒë·ªô Sleep): 
        ```bash
        python main.py --mode sleep_analysis
        ```

## ‚öôÔ∏è Tri·ªÉn khai tr√™n GitHub Actions

B·∫°n kh√¥ng c·∫ßn server ri√™ng, Bot s·∫Ω ch·∫°y t·ª± ƒë·ªông tr√™n GitHub.

1.  **Fork** d·ª± √°n n√†y v·ªÅ GitHub c·ªßa b·∫°n.
2.  V√†o **Settings** > **Secrets and variables** > **Actions**.
3.  Th√™m c√°c **Repository secrets** sau (L·∫•y gi√° tr·ªã t·ª´ file `.env` c·ªßa b·∫°n):
    * `TELEGRAM_TOKEN`
    * `GEMINI_API_KEY`
    * `NOTION_TOKEN`
    * `NOTION_DATABASE_ID`

4.  GitHub Actions s·∫Ω t·ª± ƒë·ªông ch·∫°y theo l·ªãch:
    * **Sleep Analysis:** 07:30 (Gi·ªù VN).
    * **Daily Report:** 17:00 (Gi·ªù VN).

---

## ‚ö° C·∫•u h√¨nh Telegram Trigger (Cloudflare Workers)

ƒê·ªÉ chat v·ªõi Bot v√† nh·∫≠n k·∫øt qu·∫£ ngay l·∫≠p t·ª©c (thay v√¨ ch·ªù l·ªãch ch·∫°y), h√£y l√†m theo b∆∞·ªõc n√†y:

### B∆∞·ªõc 1: T·∫°o GitHub Workflow
ƒê·∫£m b·∫£o trong repo c√≥ file `.github/workflows/telegram_trigger.yml` ƒë·ªÉ l·∫Øng nghe s·ª± ki·ªán `repository_dispatch`.

### B∆∞·ªõc 2: T·∫°o Cloudflare Worker
1.  ƒêƒÉng nh·∫≠p Cloudflare > **Workers & Pages** > **Create Worker**.
2.  V√†o **Edit Code** v√† d√°n code JavaScript x·ª≠ l√Ω Webhook (Code bridge g·ªçi GitHub API).
3.  V√†o **Settings** > **Variables and Secrets** > Th√™m c√°c bi·∫øn:
    * `GITHUB_TOKEN`: Token GitHub (Classic) c√≥ quy·ªÅn `repo` & `workflow`.
    * `TG_BOT_TOKEN`: Token Telegram Bot.
    * `ALLOWED_USER_ID`: ID Telegram c·ªßa b·∫°n (ƒë·ªÉ b·∫£o m·∫≠t).
    * `GITHUB_OWNER` & `GITHUB_REPO`: Th√¥ng tin repo c·ªßa b·∫°n.

### B∆∞·ªõc 3: K·∫øt n·ªëi Webhook
Ch·∫°y ƒë∆∞·ªùng d·∫´n sau tr√™n tr√¨nh duy·ªát ƒë·ªÉ b√°o Telegram chuy·ªÉn tin nh·∫Øn v·ªÅ Cloudflare: